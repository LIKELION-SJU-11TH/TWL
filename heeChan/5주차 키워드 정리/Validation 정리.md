# Validation (유효성 검사)

먼저 Validation에는 형식적 validation과 논리적 validation 존재

# **형식적 validation**

 ****Controller에서 검사 ( null, 정해진 길이에 맞는지, 파일 형식,등등)

- 필수 입력 필드에 데이터를 입력하지 않으면  어떻게 될까?
    
    또는 고객이 유효하지 않은 신용카드를 입력했다면? 
    

1. 정규 표현식
    
    문자를 표현하는 공식 
    

1. 스프링 자바의 빈 유효성 검사 API

이것을 사용한다면 애플리케이션에 추가 코드를 작성하지 않고 유효성 검사 규칙을 쉽게 선언할 수 있다. 그리고 스프링 부트를 사용한다면 유효성 검사 라이브러리를 프로젝트에 쉽게 추가할 수 있다.

스프링 MVC에 유효성 검사를 적용하기

- 유효성을 검사할 클래스에 검사 규칙을 선언 ( 객체 클래스 Not Entity )
- 유효성 검사를 해야 하는 컨트롤러 메서드에 검사를 수행한다는 것을 지정한다.
- 검사 에러를 보여줘야한다. ( HTML에서 보여줘서 유저가 어떤 입력이 틀렸는지 바로 알 수 있도록 도와줌)

—> 유효성 검사는 몇가지 애노테이션을 제공, 이것들로 검사 규칙을 선언 하기  위해 도메인 객체의 속성에 지정 가능

**@Notnull** : null 값이 아니어야 한다는 규칙

**@Size** : 최소 개수 제한

**@NotBlank** : 빈칸이 아니어야한다.

**@CreditCardNumber**는 field의 값이 룬 알고리즘 검사에 합격한 유효한 신용 카드 번호이어야 한다는 것을 선언한다. But 이 카드 번호가 실제로 존재하는 것인지는 알 수 없다. —> 실시간으로 금융망과 연동해야 알 수 있음.

MM/YY 형식의 검사에 사용할 수 있는 애노테이션이 존재하지 않으므로

**@Pattern** 애노테이션에 정규 표현식을 지정하여 해당 Pattern이 붙은 Field값이 형식에 따르는지 확인

@Digits : 입력 숫자 값의 길이가 지정된 숫자 값이어야 한다.

모든 유효성 검사 애노테이션은 Message속성을 갖고 있어서 선언된 유효성 규칙을

충족하지 못할 때 보여줄 메시지를 message 속성에 정의

각 폼의 Post 요청이 관련 메서드에서 처리될 때 유효성 검사가 수행되도록 컨트롤러

수정해야 됨 —> @Valid

Post로 요청된 값의 유효성 검사를 하려면 컨트롤러의 해당 메서드의 인자로 전달되는 변수의 자바 빈 유효성 검사 API의 @Vaild를 추가해야함

형식적 유효성 검사를 정리하자면

- 사용자가 요구되는 입력 형식을 지키지 않았을 때를 검사하는 것
- 자바의 빈 유효성 검사 API를 활용해서 유효성 검사를 수행한다.
- Controller로 들어오는 입력값들을 받을 객체의 클래스에 field에 유효성 검사 어노테이션을 붙인다.
- 이후 Controller에서 해당 객체를 매개변수로 받는 경우에 @Valid 어노테이션을 붙여 해당 객체의 정해져있는 유효성을 검사한다.

**논리적 Validation**

ex) 회원 가입시 이미 존재하는 이메일이라면 가입을 제한해야 함.

1. 유저의 form이 Controller에 도착하면 일단 형식적 validation을 검사 후 형식이 다 맞다면 서비스로 해당 객체를 전달.
2. 서비스 Component에서는 Select email where email=” ” 와 같은 쿼리문으로 해당 이메일이 데이터베이스에 존재하는지 확인한다. 
3. 데이터베이스에 이미 그 이메일이 존재한다면 가입을 차단한다( 논리적 유효성 검사)